import time
import pandas as pd
import json
from datetime import datetime
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.common.exceptions import NoSuchElementException, TimeoutException
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from webdriver_manager.chrome import ChromeDriverManager

def scrape_molex_final(part_number):
    
    chrome_options = Options()
    chrome_options.add_argument("--headless")
    chrome_options.add_argument("--start-maximized")
    chrome_options.add_argument("user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36")
    chrome_options.add_experimental_option('excludeSwitches', ['enable-logging'])

    service = Service(ChromeDriverManager().install())
    driver = webdriver.Chrome(service=service, options=chrome_options)

    target_url = f'https://www.molex.com/en-us/products/part-detail/{part_number}'
    product_data = {'Part Number Scanned': part_number, 'URL': target_url}

    try:
        print(f"[{part_number}] 크롤링 시작: {target_url}")
        driver.get(target_url)
        WebDriverWait(driver, 20).until(EC.presence_of_element_located((By.ID, "part-details")))
        print(f"[{part_number}] 페이지 로드 완료. 데이터 추출 중...")

        # --- 최종 데이터 추출 로직 ---

        # 1. Part Details 테이블 파싱
        try:
            part_details_tables = driver.find_elements(By.CSS_SELECTOR, '.cmp-partdetails__table-desktop tbody')
            for table in part_details_tables:
                rows = table.find_elements(By.TAG_NAME, 'tr')
                for row in rows:
                    headers = row.find_elements(By.TAG_NAME, 'th')
                    cells = row.find_elements(By.TAG_NAME, 'td')
                    for i in range(len(headers)):
                        key, value = headers[i].text.strip(), cells[i].text.strip()
                        if key:
                            product_data[key] = value
        except NoSuchElementException:
            print(f"[{part_number}] 경고: 제품 상세 정보 테이블을 찾을 수 없습니다.")

        # 2. 이미지, 환경 규정 등 나머지 데이터 추출
        try:
            product_data['IMG'] = driver.find_element(By.CSS_SELECTOR, '.pdp-mediagallery__image img').get_attribute('src')
        except NoSuchElementException:
            product_data['IMG'] = "Not Found"
            
        try:
            compliance_table = driver.find_element(By.CLASS_NAME, 'cmp-pdp__compliance_table')
            rows = compliance_table.find_elements(By.TAG_NAME, 'tr')
            for row in rows:
                key = row.find_element(By.TAG_NAME, 'th').text.replace(':', '').strip()
                value = row.find_element(By.TAG_NAME, 'td').text.strip()
                if key: product_data[key] = value
        except NoSuchElementException:
            print(f"[{part_number}] 경고: 환경 규정 정보 테이블을 찾을 수 없습니다.")

    except TimeoutException:
        print(f"오류: [{part_number}] 페이지 로드 시간이 초과되었습니다.")
        product_data['Status'] = 'Page Load Timeout'
    except Exception as e:
        print(f"오류: [{part_number}] 크롤링 중 알 수 없는 오류가 발생했습니다: {e}")
        product_data['Status'] = f'Error: {e}'
    finally:
        if driver: driver.quit()
        
    print(f"[{part_number}] 크롤링 완료.")
    return product_data

# --- 스크립트 실행 부분 ---
if __name__ == "__main__":
    
    part_numbers = [
        '03091011',
        '08700056',
        '08700058',
        '08700064',
        '08700102',
        '08700106',
        '08701031',
        '08701039',
        '1042126411',
        '1042132011',
        '1042132211',
        '1042132221',
        '1480286001',
        '1510492201',
        '1510492209',
        '1510492211',
        '1510492401',
        '1510492411',
        '1510492601',
        '1512072211',
        '190010001',
        '190020005',
        '190020028',
        '190020044',
        '190040001',
        '190070041',
        '190070064',
        '190070067',
        '190090007',
        '190250005',
        '190360003',
        '190710140',
        '190730170',
        '2011152062',
        '2011155000',
        '2011162062',
        '2011165000',
        '2011172030',
        '2014932100',
        '2014952100',
        '2018610120',
        '2018612101',
        '2018615000',
        '2024830041',
        '2029884241',
        '2041020209',
        '2041020219',
        '2041020409',
        '2041020419',
        '2041020429',
        '2041020609',
        '2052080609',
        '2052080809',
        '2052081009',
        '2053380002',
        '2053410202',
        '2053410203',
        '2053410204',
        '2053410206',
        '2053425028',
        '2081001',
        '2137192080',
        '2140922020',
        '2140922040',
        '2140922050',
        '2140922060',
        '2140935000',
        '2173470300',
        '2173470390',
        '2173478000',
        '2173478100',
        '22011022',
        '22011032',
        '22011042',
        '22011052',
        '22011062',
        '22011064',
        '22011082',
        '22011092',
        '22011102',
        '22013037',
        '22035025',
        '22035035',
        '22035045',
        '22035055',
        '22035065',
        '22035075',
        '22035085',
        '22035095',
        '22035105',
        '22035145',
        '22041021',
        '22041031',
        '22041041',
        '22041051',
        '22041061',
        '22041081',
        '22041091',
        '22041101',
        '22041141',
        '22051092',
        '22053031',
        '22057025',
        '22057035',
        '22057045',
        '22057055',
        '22057065',
        '22057075',
        '22057085',
        '22057095',
        '22057125',
        '22173022',
        '22232031',
        '29110023',
        '29110033',
        '29110042',
        '29110043',
        '29110052',
        '29110053',
        '310671010',
        '310681010',
        '313721000',
        '314032110',
        '314032210',
        '314032700',
        '314033100',
        '330000001',
        '330000002',
        '330000003',
        '330001001',
        '330001002',
        '330001003',
        '330001004',
        '334721201',
        '334721206',
        '334722001',
        '334722006',
        '334724801',
        '334724806',
        '334810301',
        '334810606',
        '334812201',
        '334821206',
        '334823601',
        '334823617',
        '334824001',
        '334824002',
        '334824117',
        '334824118',
        '334824801',
        '334828601',
        '340620023',
        '340620027',
        '340620051',
        '340624009',
        '343450001',
        '343454001',
        '350211001',
        '350211160',
        '350211201',
        '350211301',
        '350211321',
        '350211360',
        '350220002',
        '350220003',
        '350220004',
        '350220005',
        '350220006',
        '350220007',
        '350220008',
        '350220009',
        '350220010',
        '350220011',
        '350220012',
        '350220013',
        '350220014',
        '350220015',
        '350230002',
        '350230003',
        '350230004',
        '350230005',
        '350230006',
        '350230007',
        '350230008',
        '350230009',
        '350230010',
        '350230011',
        '350230012',
        '350230013',
        '350230014',
        '350230015',
        '350289502',
        '350369802',
        '350369902',
        '350409502',
        '350449102',
        '350449104',
        '350539002',
        '350689702',
        '350689722',
        '350689802',
        '350689812',
        '350689822',
        '350689842',
        '350689902',
        '350729702',
        '350729712',
        '350729802',
        '350729902',
        '350979702',
        '350979712',
        '350979732',
        '350979802',
        '350979812',
        '350989702',
        '350989802',
        '351120210',
        '351500100',
        '351500109',
        '351500110',
        '351500193',
        '351500200',
        '351500202',
        '351500204',
        '351500209',
        '351500210',
        '351500212',
        '351500214',
        '351500219',
        '351500290',
        '351500292',
        '351500293',
        '351500294',
        '351500296',
        '351500300',
        '351500304',
        '351500309',
        '351500310',
        '351500314',
        '351500319',
        '351500390',
        '351500392',
        '351500393',
        '351500394',
        '351500396',
        '351500400',
        '351500409',
        '351500410',
        '351500412',
        '351500414',
        '351500419',
        '351500600',
        '351500604',
        '351500609',
        '351500610',
        '351500612',
        '351500614',
        '351500619',
        '351502619',
        '351503209',
        '351503219',
        '351503309',
        '351503319',
        '351503419',
        '351503609',
        '351503619',
        '351504209',
        '351504219',
        '351504319',
        '351504419',
        '351504609',
        '351504619',
        '351510109',
        '351510110',
        '351510119',
        '351510210',
        '351510211',
        '351510212',
        '351510214',
        '351510219',
        '351510310',
        '351510314',
        '351510319',
        '351510410',
        '351510412',
        '351510414',
        '351510419',
        '351510610',
        '351510614',
        '351510619',
        '351512219',
        '351513219',
        '351513619',
        '351514219',
        '351514319',
        '351514419',
        '351514619',
        '351530300',
        '351550200',
        '351550203',
        '351550300',
        '351550400',
        '351550500',
        '351550600',
        '351550700',
        '351550800',
        '351550900',
        '351551000',
        '351551100',
        '351551200',
        '351551300',
        '351551400',
        '351551500',
        '351560200',
        '351560300',
        '351560400',
        '351560500',
        '351560600',
        '351560700',
        '351560800',
        '351560900',
        '351561100',
        '351610100',
        '351620100',
        '351650100',
        '351650102',
        '351790300',
        '351790480',
        '351800209',
        '351800229',
        '351800400',
        '351800404',
        '351800409',
        '351800600',
        '351800604',
        '351800609',
        '351802409',
        '351802609',
        '351803409',
        '351803609',
        '351804409',
        '351804609',
        '351810200',
        '351810210',
        '351810214',
        '351810220',
        '351820190',
        '351820192',
        '351820193',
        '351820194',
        '351820290',
        '351820292',
        '351820390',
        '351820392',
        '351840200',
        '351840300',
        '351840400',
        '351840500',
        '351840600',
        '351840700',
        '351840800',
        '351840900',
        '351841000',
        '351841100',
        '351841200',
        '351841400',
        '351860610',
        '351890110',
        '351890111',
        '351890200',
        '351890202',
        '351890203',
        '351890204',
        '351890250',
        '351890260',
        '351890281',
        '351890290',
        '351890292',
        '351890294',
        '351890390',
        '351960110',
        '351960111',
        '351960294',
        '352040192',
        '352040194',
        '352040196',
        '352040292',
        '352040294',
        '352142010',
        '352145510',
        '352145570',
        '353120210',
        '353120250',
        '353120260',
        '353120263',
        '353120330',
        '353120360',
        '353120362',
        '353120460',
        '353120560',
        '353120660',
        '353120760',
        '353120860',
        '353121060',
        '353121260',
        '353121460',
        '353121560',
        '353130260',
        '353130360',
        '353130460',
        '353130560',
        '353130660',
        '353130760',
        '353130960',
        '353131010',
        '353131060',
        '353131570',
        '353170620',
        '353170820',
        '353171210',
        '353171220',
        '353171420',
        '353172220',
        '353172420',
        '353180360',
        '353180420',
        '353180820',
        '353181020',
        '353181220',
        '353181420',
        '353181620',
        '353181820',
        '353182220',
        '355070200',
        '355070300',
        '355070400',
        '355070500',
        '355070600',
        '355070700',
        '355070800',
        '355070900',
        '355071000',
        '355071100',
        '355071200',
        '355071300',
        '355071400',
        '355071500',
        '355071600',
        '355071800',
        '355072000',
        '355240920',
        '355240924',
        '355240929',
        '355244929',
        '357450110',
        '357450210',
        '357450210',
        '357450310',
        '357450410',
        '357460110',
        '357460210',
        '357460310',
        '357460410',
        '357460411',
        '357460510',
        '357470110',
        '357470210',
        '357470310',
        '357470410',
        '357480110',
        '357480210',
        '357480310',
        '357480410',
        '357501010',
        '359650200',
        '359650203',
        '359650204',
        '359650210',
        '359650212',
        '359650214',
        '359650220',
        '359650290',
        '359650292',
        '359650293',
        '359659200',
        '359659203',
        '359659210',
        '359659213',
        '359659220',
        '359659222',
        '359659223',
        '359659224',
        '359770200',
        '359770300',
        '359770400',
        '359770700',
        '359770790',
        '359771100',
        '359771190',
        '365350001',
        '365360001',
        '366430002',
        '366440002',
        '367921201',
        '367990001',
        '367990002',
        '39000021',
        '39000038',
        '39000040',
        '39000046',
        '39000048',
        '39000049',
        '39000065',
        '39000077',
        '39000079',
        '39000081',
        '39000160',
        '39000183',
        '39000219',
        '39000282',
        '39000372',
        '39000454',
        '39012020',
        '39012021',
        '39012025',
        '39012026',
        '39012040',
        '39012041',
        '39012045',
        '39012046',
        '39012060',
        '39012061',
        '39012065',
        '39012066',
        '39012080',
        '39012081',
        '39012085',
        '39012086',
        '39012100',
        '39012101',
        '39012105',
        '39012106',
        '39012120',
        '39012121',
        '39012125',
        '39012140',
        '39012141',
        '39012145',
        '39012160',
        '39012161',
        '39012165',
        '39012180',
        '39012181',
        '39012200',
        '39012201',
        '39012205',
        '39012220',
        '39012221',
        '39012240',
        '39012241',
        '39013023',
        '39013029',
        '39013043',
        '39013045',
        '39013049',
        '39013089',
        '39014030',
        '39014031',
        '39014032',
        '39014040',
        '39014041',
        '39014043',
        '39014050',
        '39014051',
        '39014057',
        '40062003',
        '40062024',
        '414225001',
        '420232015',
        '420241019',
        '424000004',
        '428150012',
        '428150114',
        '428160212',
        '428160312',
        '428170012',
        '428171014',
        '428180312',
        '430200200',
        '430200601',
        '430201400',
        '430201600',
        '430202000',
        '430202400',
        '430250200',
        '430250400',
        '430250600',
        '430250800',
        '430251000',
        '430251200',
        '430252000',
        '430300001',
        '430300004',
        '430300008',
        '430300038',
        '430310001',
        '430310004',
        '430315008',
        '430450400',
        '430451009',
        '430451021',
        '430451609',
        '431801002',
        '433352002',
        '433357002',
        '433750001',
        '433751001',
        '433752001',
        '436400200',
        '436400300',
        '436400301',
        '436400311',
        '436400501',
        '436450200',
        '436450300',
        '436450308',
        '436450400',
        '436450500',
        '436450508',
        '436451000',
        '436500304',
        '436500515',
        '436500527',
        '436500615',
        '436801002',
        '436802002',
        '439141105',
        '439801005',
        '441331400',
        '441332000',
        '441440003',
        '443000600',
        '443001400',
        '444412002',
        '445160003',
        '447640401',
        '457501111',
        '457503111',
        '459380002',
        '460121141',
        '460123141',
        '462350003',
        '469920410',
        '469920610',
        '469930210',
        '469930410',
        '469930411',
        '469930610',
        '469930611',
        '469990275',
        '477156102',
        '477256010',
        '477256030',
        '482580001',
        '490680710',
        '494490203',
        '494641418',
        '495060700',
        '495070790',
        '495080301',
        '495090301',
        '495110301',
        '495180590',
        '495430892',
        '495431692',
        '495440892',
        '495450892',
        '495470392',
        '495480390',
        '496171011',
        '496171021',
        '496230695',
        '496231095',
        '496240695',
        '496241090',
        '496241095',
        '496250582',
        '496270382',
        '496270582',
        '496270695',
        '496271082',
        '498389102',
        '499368002',
        '500118000',
        '500128000',
        '500138000',
        '5002541927',
        '500348000',
        '500388000',
        '500398000',
        '500588000',
        '500588001',
        '500588500',
        '5005920200',
        '5005920400',
        '5005920600',
        '5005930200',
        '5005930300',
        '5005930400',
        '5005930500',
        '5005930600',
        '5006380807',
        '5006381007',
        '5006381107',
        '5006381407',
        '5006381707',
        '5007620481',
        '500798000',
        '500978000',
        '500988000',
        '5011893010',
        '5011933000',
        '501258000',
        '5013300400',
        '5013300600',
        '5013301000',
        '5013301300',
        '5013301500',
        '5013310407',
        '5013340000',
        '501338000',
        '501478000',
        '501488000',
        '5015680407',
        '5015981604',
        '5016090404',
        '5016461000',
        '5016461400',
        '5016462400',
        '5016463400',
        '5016471000',
        '502128000',
        '502178000',
        '502179001',
        '5023510200',
        '5023510201',
        '5023510400',
        '5023510500',
        '5023510600',
        '5023510700',
        '5023510800',
        '5023520200',
        '5023520201',
        '5023520300',
        '5023520301',
        '5023520600',
        '5023520800',
        '5023800200',
        '5023800300',
        '5023800400',
        '5023800500',
        '5023801200',
        '5023801300',
        '5023810000',
        '5024061401',
        '5024380000',
        '5024390200',
        '5024390400',
        '5025700893',
        '5025780200',
        '5025780300',
        '5025780500',
        '5025780600',
        '5025780800',
        '5025781000',
        '5025781100',
        '5025781500',
        '5025790000',
        '5031491000',
        '5031492000',
        '5031750800',
        '5033763010',
        '5033765020',
        '5033981892',
        '5034800440',
        '5034800640',
        '5034800800',
        '5034801000',
        '5034801600',
        '503518000',
        '503518100',
        '50361674',
        '50361736',
        '50361739',
        '503728000',
        '50375023',
        '50375033',
        '50375043',
        '50375053',
        '50375063',
        '50375073',
        '50375083',
        '50375093',
        '50375103',
        '50375113',
        '50375123',
        '50375133',
        '50375143',
        '5037630491',
        '5037640401',
        '5037650098',
        '5037722410',
        '5037762410',
        '503978000',
        '503988000',
        '5041851000',
        '504208000',
        '504497225',
        '5046940300',
        '504888000',
        '5051102091',
        '5051510200',
        '5051510501',
        '5051510800',
        '5051520500',
        '5051538000',
        '5054311000',
        '5054320801',
        '5054321001',
        '5054323001',
        '5055502420',
        '5055650301',
        '5055650601',
        '5055650701',
        '5055680371',
        '5055700200',
        '5055700601',
        '5055700801',
        '5055721000',
        '5056060800',
        '5056061200',
        '50579004',
        '50579325',
        '50579402',
        '50579403',
        '50579404',
        '50579405',
        '50579406',
        '50579408',
        '50579416',
        '50579420',
        '505978000',
        '505988000',
        '50650225',
        '506541001',
        '506609001',
        '506958000',
        '507528200',
        '507528400',
        '508028000',
        '508378000',
        '50841020',
        '50841025',
        '50841035',
        '50841060',
        '50841150',
        '50842020',
        '50842022',
        '510040500',
        '510150200',
        '510150400',
        '510150500',
        '510150900',
        '510210200',
        '510210300',
        '510210400',
        '510210500',
        '510210600',
        '510210800',
        '510210900',
        '510211000',
        '510211100',
        '510211300',
        '510211400',
        '510211500',
        '510218603',
        '510218604',
        '510218605',
        '510350300',
        '510350400',
        '510351000',
        '510360500',
        '510360700',
        '510361000',
        '510470200',
        '510470400',
        '510650200',
        '510650600',
        '510650800',
        '510670200',
        '510670300',
        '510670400',
        '510670500',
        '510670600',
        '510670700',
        '510670800',
        '510670900',
        '510671000',
        '510900500',
        '511030200',
        '511030201',
        '511030300',
        '511030400',
        '511030500',
        '511030502',
        '511030800',
        '511030900',
        '511151601',
        '511151611',
        '511161601',
        '511171605',
        '511181605',
        '511420200',
        '511420214',
        '511420600',
        '511420614',
        '511440300',
        '511440700',
        '511630200',
        '511630300',
        '511630500',
        '511630600',
        '511630800',
        '511631500',
        '511640205',
        '511640305',
        '511640505',
        '511640605',
        '511640805',
        '511641505',
        '511910200',
        '511910400',
        '511910500',
        '511910600',
        '511980700',
        '511980800',
        '511980900',
        '512160200',
        '512160300',
        '512160400',
        '512160500',
        '512160502',
        '512160600',
        '512160700',
        '512160800',
        '512160900',
        '512161000',
        '512161100',
        '512161200',
        '512170305',
        '512170605',
        '512170705',
        '512170805',
        '512170905',
        '512171005',
        '512171205',
        '512270200',
        '512270300',
        '512270400',
        '512270500',
        '512270600',
        '512270700',
        '512270800',
        '512271000',
        '512271200',
        '512271400',
        '513380574',
        '513460800',
        '513470300',
        '513480413',
        '513531000',
        '513531200',
        '513531400',
        '513531600',
        '513531800',
        '513532200',
        '513532400',
        '513532600',
        '513532800',
        '513533400',
        '513820200',
        '513820300',
        '513820400',
        '513820700',
        '513820800',
        '513820900',
        '513821000',
        '513821300',
        '520441745',
        '520451745',
        '521160241',
        '521160341',
        '521160410',
        '521160411',
        '521170240',
        '521170241',
        '521170340',
        '521170341',
        '521170411',
        '522070433',
        '522071233',
        '522071260',
        '522130211',
        '522130311',
        '522660211',
        '522660411',
        '522710479',
        '522710579',
        '522711079',
        '522711579',
        '524651071',
        '524651271',
        '524652471',
        '525590652',
        '525590672',
        '525590834',
        '525591052',
        '525592034',
        '525593252',
        '526100533',
        '526100571',
        '526100733',
        '526100771',
        '526101033',
        '526101071',
        '527452296',
        '527460671',
        '527461270',
        '528850274',
        '528850374',
        '528850474',
        '530150410',
        '530470210',
        '530470310',
        '530470410',
        '530470610',
        '530470660',
        '530480210',
        '530480310',
        '530480410',
        '530480610',
        '532530870',
        '532540270',
        '532540870',
        '532580529',
        '532580929',
        '532581229',
        '532590329',
        '532610271',
        '532610371',
        '532610471',
        '532610571',
        '532610671',
        '532610771',
        '532610871',
        '532610971',
        '532611071',
        '532611171',
        '532611271',
        '532611371',
        '532611471',
        '532611571',
        '533091070',
        '533091270',
        '533092470',
        '533750310',
        '533750410',
        '533750510',
        '533750610',
        '533750710',
        '533980271',
        '533980371',
        '533980471',
        '533980571',
        '533980667',
        '533980671',
        '533980771',
        '533980871',
        '533980971',
        '533981071',
        '533981171',
        '533981271',
        '533981371',
        '533981471',
        '533981571',
        '534260310',
        '534260390',
        '534260410',
        '534260610',
        '534760210',
        '536250274',
        '536250374',
        '541325062',
        '542800609',
        '543460070',
        '545520302',
        '545525010',
        '545960810',
        '545960910',
        '545991019',
        '550910374',
        '550910474',
        '551000670',
        '555131615',
        '555141605',
        '555161609',
        '557550319',
        '557634070',
        '559591030',
        '5600200220',
        '5600200320',
        '5600200420',
        '5600200421',
        '5600200422',
        '5600200430',
        '5600200520',
        '5600200620',
        '5600200720',
        '5600200820',
        '5600201120',
        '5600230421',
        '5600230444',
        '5600230448',
        '5600230721',
        '5600850101',
        '5601230200',
        '5601230201',
        '5601230202',
        '5601230300',
        '5601230301',
        '5601230400',
        '5601230401',
        '5601230500',
        '5601230600',
        '5601230600',
        '5601230601',
        '5601230800',
        '5601231000',
        '5601231200',
        '5601240101',
        '5601250200',
        '5601250300',
        '5601250301',
        '5601250400',
        '5601250500',
        '5601250600',
        '5601250601',
        '5601250800',
        '5601251000',
        '5601251200',
        '560868000',
        '561348000',
        '561349000',
        '561618081',
        '561888000',
        '562658000',
        '571306000',
        '579158001',
        '579206002',
        '579649702',
        '579899810',
        '579899910',
        '579909710',
        '579909810',
        '579955610',
        '579955710',
        '591230000',
        '593708000',
        '594630000',
        '594648000',
        '684160304',
        '87000589',
        '901190109',
        '901190110',
        '981951211',
        '981951212',
        '986581211',
        '988161111',
        '988171021',
        '988171041',
        '988221020',
        '988221028',
        '988601012',
        '988971109',
        '988971119',
        '988971129',
        '99990986',
        '99990987',
        '99990988',
        '99990989',
        '99990990',
        '99990991',
        '99990992',
        '99990993',
        '99990994',
        '99990995',
        '99990997',
        '99990998',
        '99990999'
    ]

    all_results = []
    start_total_time = time.time()

    print(f"총 {len(part_numbers)}개의 부품에 대한 크롤링을 시작합니다.\n" + "-" * 40)
    for i, pn in enumerate(part_numbers):
        result = scrape_molex_final(pn)
        if result: all_results.append(result)
        
        if i < len(part_numbers) - 1:
            print("다음 작업을 위해 3초 대기합니다...")
            time.sleep(3)
        print("-" * 40)
    
    end_total_time = time.time()
    print(f"모든 크롤링 작업이 완료되었습니다. (총 소요 시간: {end_total_time - start_total_time:.2f}초)")

    if all_results:
        df = pd.DataFrame(all_results)
        
        # 컬럼 순서를 요청에 맞게 변경
        desired_columns = [
            'Part Number Scanned', 'Part Number', 'IMG', 'URL', 'GADSL/IMDS', 'China RoHS', 
            'EU ELV', 'Low-Halogen Status', 'REACH SVHC', 'EU RoHS'
        ]
        existing_columns = [col for col in desired_columns if col in df.columns]
        other_columns = [col for col in df.columns if col not in existing_columns]
        df = df[existing_columns + other_columns]

        print("\n--- 최종 크롤링 결과 미리보기 (상위 5개) ---\n", df.head())
        
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f'molex_products_{timestamp}.xlsx'

        try:
            df.to_excel(filename, index=False)
            print(f"\n★★★ 모든 데이터를 '{filename}' 파일로 성공적으로 저장했습니다. ★★★")
        except Exception as e:
            print(f"\n엑셀 파일 저장 중 오류가 발생했습니다: {e}")
    else:
        print("\n추출된 데이터가 없어 파일을 저장하지 않습니다.")